# Render Blueprint - Chronofact.ai
# This file defines the infrastructure for automatic deployment

services:
  # Backend API Service
  - type: web
    name: chronofact-api
    runtime: python
    buildCommand: pip install -r requirements.txt && pip install baml-py && baml-cli generate
    startCommand: python start_production.py
    plan: free  # Explicitly set to free tier
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: PORT
        value: "10000"  # Explicitly set port
      - key: SKIP_MULTIMODAL
        value: "true"  # Skip heavy CLIP model on free tier
      - key: GOOGLE_API_KEY
        sync: false  # Set manually in Render dashboard
      - key: QDRANT_MODE
        value: cloud
      - key: QDRANT_URL
        sync: false  # Set manually in Render dashboard
      - key: QDRANT_API_KEY
        sync: false  # Set manually in Render dashboard
    healthCheckPath: /health
    autoDeploy: true

  # Frontend Service
  - type: web
    name: chronofact-frontend
    runtime: node
    buildCommand: |
      cd frontend
      npm install -g bun
      bun install
      bun run build
    startCommand: cd frontend && bun server.ts
    envVars:
      - key: NODE_VERSION
        value: "20"
      - key: API_URL
        fromService:
          name: chronofact-api
          type: web
          property: host
    autoDeploy: true

